this.Reqs=function(a){var b=function(){class a{encodeKey(a){return a.key=this.key,JSON.stringify(a)}decodeKey(a){var b;if(b=JSON.parse(a),b.key!==this.key)throw new Error("Wrong API Key");return delete b.key,b}constructor(a){a&&(this.key=a,this.encode=this.encodeKey,this.decode=this.decodeKey)}}return a.category="coders",a.option="coder",a.prototype.encode=JSON.stringify,a.prototype.decode=JSON.parse,a}.call(this);var c,d,e,f,g,h,i,j,k,l,n={}.hasOwnProperty;l={none:0,method:1,callback:2,resolve:3,reject:4,error:5,info:6,0:"none",1:"method",2:"callback",3:"resolve",4:"reject",5:"error",6:"info"},c=function(){var a;class b{constructor(b){var c,d;for(c in this.props=[],b)n.call(b,c)&&(d=b[c],this.props.push(new a(c,d)))}validate(a,b){var c,d,e,f;for(f=this.props,c=0,d=f.length;c<d;c++)e=f[c],e.validate(a,b);return this}static required(a,b={}){return Object.assign(b,{type:a,required:!0})}}return a=class a{constructor(b,c){var d,e,f,g,h,i,k,l;for(this.name=b,o.isString(c)?g={type:[c]}:(g=c,o.isString(g.type)&&(g.type=[g.type])),this.type=o.null(),i=g.type,(d=0,e=i.length);d<e;d++)l=i[d],this.type[l]=!0;if(this.required=void 0!==g.required&&g.required,g.value&&(this.value=new a(null,g.value)),g.props)for(f in this.props=[],k=g.props,k)n.call(k,f)&&(h=k[f],this.props.push(new a(f,h)))}validate(a,b,c,d){var e,f,g,h,m,n,p,q,r,s;if(c=this.name||c,this.required||Object.hasOwnProperty.call(b,c)){if(s=b[c],r=o.typeOf(s),d?o.isNumber(c)?d+=`[${c}]`:d+=`.${c}`:d=c,!0!==this.type[r]&&(l=Object.keys(this.type).join(", "),a.throw(`Request property type validation fail. Property: '${d}'. Expected types: '${l}'. Got type: '${r}'.`)),this.value&&"Array"===r)for(e=g=0,m=s.length;g<m;e=++g)f=s[e],this.value.validate(a,s,e,d);if(this.props&&"Object"===r)for(q=this.props,h=0,n=q.length;h<n;h++)p=q[h],p.validate(a,s,null,d)}return this}},b.Property=a,b}.call(this),j=class{constructor(a){this.type=a}},h=class extends j{constructor(a,b,c,d){super(l.method),this.method=a,b&&(this.id=b),c&&(this.args=c),d&&(this.cbs=d)}},e=class extends j{constructor(a,b,c){super(l.callback),this.id=a,b&&(this.args=b),c&&(this.cbs=c)}},k=class extends j{constructor(a,b){super(l.resolve),this.id=a,this.resolve=b}},i=class extends j{constructor(a,b){super(l.reject),this.id=a,this.reject=b}},f=class extends j{constructor(a="",b=null,c){super(l.error),this.message=a,this.code=b,c&&(this.id=c)}},g=class extends j{constructor(a,b,c){super(l.info),this.id=a,b&&(this.events=b),c&&(this.methods=c)}},d=function(){class a{constructor(a={}){this.options=a,this.model={request:new c({type:c.required("Number")}),method:new c({method:c.required("String"),id:"String",args:"Array",cbs:"Array"}),callback:new c({id:c.required("String"),args:"Array",cbs:"Array"}),promise:new c({id:c.required("String")}),error:new c({message:c.required("String"),code:"Number",id:"String"}),info:new c({id:c.required("String"),events:"Array",methods:"Array"})}}throw(a){throw new Error(`Protocol processing error: ${a}`)}parse(a){var b;switch(this.model.request.validate(this,a),a.type){case l.method:this.model.method.validate(this,a),b=new h(a.method,a.id,a.args,a.cbs);break;case l.callback:this.model.callback.validate(this,a),b=new e(a.id,a.args,a.cbs);break;case l.resolve:this.model.promise.validate(this,a),b=new k(a.id,a.resolve);break;case l.reject:this.model.promise.validate(this,a),b=new i(a.id,a.reject);break;case l.error:this.model.error.validate(this,a),b=new f(a.message,a.code,a.id);break;case l.info:this.model.info.validate(this,a),b=new g(a.id,a.events,a.methods);break;default:b=this.throw(`Unknown request type: ${a.type}`);}return b}}return a.category="protocols",a.option="coder",a.types=l,a.prototype.types=l,a.Model=c,a.prototype.Method=h,a.Method=h,a.prototype.Callback=e,a.Callback=e,a.prototype.Resolve=k,a.Resolve=k,a.prototype.Reject=i,a.Reject=i,a.prototype.Error=f,a.Error=f,a.prototype.Info=g,a.Info=g,a}.call(this);var o=function(){var a,b;class c{static isBoolean(a){return"[object Boolean]"===b.call(a)}static isString(a){return"[object String]"===b.call(a)}static isObject(a){return"[object Object]"===b.call(a)}static isFunction(a){return"[object Function]"===b.call(a)}static isNumber(a){return a===a&&"[object Number]"===b.call(a)}static typeOf(a){return b.call(a).slice(8,-1)}static null(a){return Object.assign(Object.create(null),a)}}return b=Object.prototype.toString,a=Array.isArray,c.isArray=Array.isArray,c}.call(this);var p,n={}.hasOwnProperty;return p=function(){var c,f,g,a=Number.MAX_SAFE_INTEGER;class h{constructor(a={}){var b,c,d,e,g,i,j,k;if(this.events=o.null(),this.methods=o.null(),this.isSession=!1,this._callbacks=o.null(),this._id=0,this._promises=o.null(),this._pid=0,a.events)for(e in j=a.events,j)n.call(j,e)&&(d=j[e],this.events[e]=d);if(a.methods&&this.addMethods(a.methods),this.options={methods:a.methods||{},session:a.session},a.send&&(this.send=a.send),a.error&&(this.error=a.error),a.newid&&(this.newid=a.newid),a.newpid&&(this.newpid=a.newpid),c=a.key?[a.key]:[],!a.coder)b=h.coders[h.default.coder];else if(o.isString(a.coder)?b=h.coders[a.coder]:(b=h.coders[a.coder.name||h.default.coder],a.coder.arguments&&(c=a.coder.arguments)),!b)throw new Error(`Unknown coder: '${a.coder}'`);if(this.coder=new b(...c),i=[],!a.protocol)g=h.protocols[h.default.protocol];else if(o.isString(a.protocol)?g=h.protocols[a.protocol]:(g=h.protocols[a.protocol.name||h.default.protocol],a.protocol.arguments&&(i=a.protocol.arguments)),!g)throw new Error(`Unknown protocol: '${a.protocol}'`);this.protocol=new g(...i),a.session?(k=a.session.arguments,o.isString(k)?this.options.session.arguments=[k]:o.isArray(k)&&(this.options.session.arguments=k)):this.options.session={arguments:[]},Object.defineProperty(this,"async",{get:()=>this._async,set:a=>this.asyncSet(a)}),this.async=o.isBoolean(a.mode)?"async"===a.mode:"async"===h.default.mode}parse(a){var b,c,d,f,g,h;try{b=this.coder.decode(a)}catch(a){return c=a,this.err400(`Data processing error: ${c.message}\n${c.stack}`)}try{if(o.isArray(b))for(d=0,f=b.length;d<f;d++)g=b[d],h=this.processRequest(g);else h=this.processRequest(b)}catch(a){return c=a,this.err400(`Request parsing error: ${c.message}\n${c.stack}`)}return h}processRequest(a){var b,c,d,g,h,i,j,k,l,m,n;switch(j=this.protocol.parse(a),i=this.protocol,m=i.types,d=j.id,j.type){case m.method:if(g=j.method,n=this.events[g],n){if(b=f(this,j.args,j.cbs),d){try{if(l=n.apply(this,b),l instanceof Promise)return l.then(a=>this.request(new i.Resolve(d,a))).catch(a=>this.request(new i.Reject(d,a.toString()))),l;k=new i.Resolve(d,l)}catch(a){c=a,k=new i.Reject(d,c.toString())}return this.request(k)}return n.apply(this,b)}return this.err404(`Method not found: <${g}>.`);break;case m.callback:return(n=this._callbacks[d],void 0===n)?this.err404(`Wrong callback ID: <${d}>.`):(delete this._callbacks[d],b=f(this,j.args,j.cbs),n.apply(this,b||[]));case m.resolve:return h=this._promises[d],delete this._promises[d],h&&h.resolve?h.resolve.call(this,j.resolve):this.err404(`Wrong resolve promise ID: <${d}>.`);break;case m.reject:return h=this._promises[d],delete this._promises[d],h&&h.reject?h.reject.call(this,j.reject):this.err404(`Wrong reject promise ID: <${d}>.`);break;case m.info:if(d)return this.request(new i.Callback(d,[Object.keys(this.methods),Object.keys(this.events)]));break;case m.error:return this.err422(`Error request. Code: '${j.code}'. ${j.message}`);default:return this.err422(`Unknown request type: '${j.type}'.`);}return null}request(a){return this.send(this.coder.encode(a))}err400(a){return this.error(a,400)}err404(a){return this.error(a,404)}err422(a){return this.error(a,422)}error(a,b){return console.warn(b,a)}sendError(a,b,c){return this.request(new this.protocol.Error(a,b,c))}asyncSet(a){this._async=a,this.methodApply=a?this.methodAsyncApply:this.methodSyncApply}coderSet(a){return this.coder=h.coders[a]}protocolSet(a){return this.protocol=h.protocols[a]}use(a,...b){return this[a.option]=new a(...b)}createCallback(a){var b,c;return b=this,c=function(){return g(b,a,arguments)},c.created=Date.now(),c}newid(){return this._id===a&&(this._id=0),(++this._id).toString()}newpid(){return this._pid===a&&(this._pid=0),(++this._pid).toString()}addCallback(a){var b;return b=this.newid(),this._callbacks[b]=a,b}method(a,...b){return this.methodApply(a,b)}methodAsync(a,...b){return this.methodAsyncApply(a,b)}methodSync(a,...b){return this.methodSyncApply(a,b)}methodAsyncApply(a,b){var d,e,f,g;return[e,d]=c(this,b),f=this.newpid(),g=new Promise((a,b)=>this._promises[f]={resolve:a,reject:b}),this.request(new this.protocol.Method(a,f,e,d)),g}methodSyncApply(a,b){var d,e;return[e,d]=c(this,b),this.request(new this.protocol.Method(a,null,e,d))}addMethod(a){var b;return b=this,this.methods[a]=function(){return b.methodApply(a,arguments)},this}createMethod(a,b,c,d,e,f=!0){var g,h,i;if(g=this,h=this.methods,!(f&&h[a]))return void 0===c?b?h[a]=function(){return g.methodApply(a,b.apply(g,arguments))}:h[a]=function(){return g.methodApply(a,arguments)}:"async"===c?(i=d&&e?b?function(){return g.methodAsyncApply(a,b.apply(g,arguments)).then(d).catch(e)}:function(){return g.methodAsyncApply(a,arguments).then(d).catch(e)}:d?b?function(){return g.methodAsyncApply(a,b.apply(g,arguments)).then(d)}:function(){return g.methodAsyncApply(a,arguments).then(d)}:e?b?function(){return g.methodAsyncApply(a,b.apply(g,arguments)).catch(e)}:function(){return g.methodAsyncApply(a,arguments).catch(e)}:b?function(){return g.methodAsyncApply(a,b.apply(g,arguments))}:function(){return g.methodAsyncApply(a,arguments)},h[a]=i):h[a]=b?function(){return g.methodSyncApply(a,b.apply(g,arguments))}:function(){return g.methodSyncApply(a,arguments)},this}addMethods(a,b){var c,d,e,f,g,h;if(g=this.methods,o.isArray(a)){for(c=0,d=a.length;c<d;c++)if(f=a[c],o.isString(f)){if(g[f])continue;this.addMethod(f)}else if(o.isObject(f))for(h in f)if(n.call(f,h)){if(e=f[h],g[h])continue;o.isFunction(e)?this.createMethod(h,e,null,null,null,b):this.createMethod(h,e.method,e.mode,e.then,e.catch,b)}}else if(o.isObject(a))for(h in a)if(n.call(a,h)){if(e=a[h],g[h])continue;o.isFunction(e)?this.createMethod(h,e,null,null,null,b):this.createMethod(h,e.method,e.mode,e.then,e.catch,b)}return this}info(a,b={}){var c;if(!o.isFunction(a))throw new Error("Reqs.info() call without callback for data.");return c=this.addCallback(a),this.request(new this.protocol.Info(c,b.events,b.methods))}build(a){return this.info((b,c)=>{if(this.addMethods(c),o.isFunction(a))return a(b,c)}),this}static addModule(a){var b;return b=this[a.category],b||(b=this[a.category]=o.null()),b[a.name]=a,a}new(){var a,b,c,d,e,f;if(this.isSession)throw new Error("<Reqs.Session instance>.new() used for new session creation. Use insted \"<Reqs instance>.new()\".");if(f=Object.create(this),0<arguments.length)for(e=this.options.session.arguments,a=b=0,c=e.length;b<c;a=++b)d=e[a],f[d]=arguments[a];return f.isSession=!0,f.created=Date.now(),f.reqs=this,f._callbacks=o.null(),f._id=0,f._promises=o.null(),f._pid=0,f.methods=o.null(),f.addMethods(this.options.methods),f}}return h.default={mode:"sync",coder:"Coder",protocol:"Protocol"},h.protocols=o.null({Protocol:d}),h.coders=o.null({Coder:b}),h.Tools=o,h.Protocol=d,h.Coder=b,h.prototype.send=console.info,c=function(a,b=[]){var d,e,f,g,h,k,c=Number.parseInt;for(e=[],f=[],(g=h=0,k=b.length);h<k;g=++h)d=b[g],o.isFunction(d)&&(d=a.addCallback(d),f.push(c(g))),e.push(d);return 0===f.length&&(f=null),[e,f]},f=function(a,b=[],c){var d,e,f,g;if(void 0===c||0===c.length)return b;for(f=0,g=c.length;f<g;f++)e=c[f],d=b[e],b[e]=a.createCallback(d);return b},g=function(a,b,d){var e,f;return[e,f]=c(a,d),a.request(new a.protocol.Callback(b,e,f))},h}.call(this),a.exports=p,a.exports}(this.module||{});